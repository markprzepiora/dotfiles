#!/usr/bin/env bash

# Cheat sheet:
# https://kapeli.com/cheat_sheets/Bash_Test_Operators.docset/Contents/Resources/Documents/index

set -o pipefail
set -eu

open () {
    setsid xdg-open "${@:-.}" > /dev/null 2>&1 &
}

selected_file=$(fd --no-ignore-vcs --exclude='**/node_modules/**' --search-path ~ "$@" | fzf --scheme=path --tiebreak=length,end --preview='[[ -d {} ]] && tree -C {} | head -100 || (bat --color=always --line-range :100 {} || head -100 {})' --preview-window=right:50% --ansi)
if [[ -n "$selected_file" ]]; then
    (open "$selected_file")
fi
