#!/usr/bin/env bash

branch=$(git branch --all --sort=-committerdate | grep -v "^\*" | cut -c 3- | fzf --height=40% --reverse --info=inline --preview="git branch-commits {}")

# Check if branch is of pattern remotes/<remote>/<branch>
if [[ $branch == remotes/* ]]; then
    # Extract remote and branch name
    remote_branch=${branch#remotes/}  # Remove "remotes/" prefix
    remote=${remote_branch%%/*}       # Extract remote name (everything before first /)
    branch_name=${remote_branch#*/}   # Extract branch name (everything after first /)

    # Create and checkout new local branch tracking the remote
    git checkout -b "$branch_name" "$remote/$branch_name"
else
    # Just checkout the existing local branch
    git checkout "$branch"
fi
